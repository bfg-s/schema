!function(t,e){for(var n in e)t[n]=e[n];e.__esModule&&Object.defineProperty(t,"__esModule",{value:!0})}(exports,(()=>{"use strict";var t={906:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Components=void 0;var n=function(){function t(t){this.app=t,this.items={}}return t.prototype.get=function(t){return this.items[t]},t.prototype.all=function(){return this.items},t.prototype.register=function(t,e){return this.items[t]=e,this.app.event.has("register_component")&&this.app.event.register_component(t,e),this},t.prototype.new=function(t){t&&"name"in t&&this.app.components.register(t.name,t)},t.prototype.has=function(t){return t in this.items},t.prototype.names=function(){return Object.keys(this.items)},t.prototype.context=function(t,e){var n=this;void 0===e&&(e=null),t.keys().forEach((function(o){var r=t(o).default,a="function"==typeof e?e(r):null;n.app.components.new(a||r)}))},t}();e.Components=n},424:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Doc=void 0;var n=function(){function t(t){var e=this;this.app=t,this.is_support_spa()&&(window.history.replaceState({url:location.href},document.title),window.setTimeout((function(){window.addEventListener("popstate",(function(t){t.preventDefault(),t.stopPropagation(),t.state.url&&e.location(t.state.url,!1)}))}),1e3))}return t.prototype.reload=function(){window.location.reload()},t.prototype.location=function(t,e){var n=this;if(void 0===e&&(e=!0),this.app.doc.is_support_spa()){var o=this.app.server.container,r=o?document.getElementById(o):document.body;r?this.app.request({url:t,headers:{"BFG-CONTENT-REQUEST":"true"}}).then((function(o){var a=o.data;o.xhr.getResponseHeader("BFG-CONTENT-RESPONSE")?(e&&n.app.doc.set_url(t),n.app.schema.content(a,r)):window.location.href=t})).catch((function(o){if(e&&n.app.doc.set_url(t),401===o.status&&"Unauthorized"===o.statusText){var a=n.app.json.decode(o.responseText);if(a&&"message"in a&&"Unauthenticated."===a.message)return void n.app.doc.reload()}n.app.schema.content(o.responseText,r)})):window.location.href=t}else window.location.href=t},t.prototype.set_url=function(t,e){void 0===e&&(e=null),this.app.doc.is_support_spa()&&(window.history.replaceState({url:location.href},document.title),window.history.pushState({url:location.href},document.title,t),window.history.replaceState({url:location.href},document.title))},t.prototype.is_support_spa=function(){return window.history&&window.history.pushState&&window.history.replaceState&&!navigator.userAgent.match(/((iPod|iPhone|iPad).+\bOS\s+[1-4]\D|WebApps\/.+CFNetwork)/)},t.prototype.is_descendant=function(t,e){for(var n=e.parentNode;null!=n;){if(n==t)return!0;n=n.parentNode}return!1},t}();e.Doc=n},665:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0});var n=function(){function t(){}return t.prototype.asset=function(t){void 0===t&&(t="");var e=this.str;return e.trim(this.server.asset,"/")+(""!==t?"/"+e.trim(t,"/"):"")},t.prototype.is_schema_root_element=function(t){return t&&"er"in t.dataset},t.prototype.is_schema_child_element=function(t){return t&&"ec"in t.dataset},t.prototype.is_schema_element=function(t){return this.is_schema_child_element(t)||this.is_schema_root_element(t)},t.prototype.get_schema_rules=function(t){if(this.is_schema_element(t)){var e="";this.is_schema_child_element(t)?e=t.dataset.ec:this.is_schema_root_element(t)&&(e=t.dataset.er);var n=String(e).split("\\"),o=n[0],r=n[1],a=t.dataset.c?this.json.decode(t.dataset.c):{},i=t.dataset.a?this.json.decode(t.dataset.a):{},s=t.getAttribute("class");s&&(i.class=s),t.querySelectorAll("[data-sf='"+r+"']").forEach((function(t){var e=t.dataset.s;e&&(a[e]=Object.assign([],t.childNodes)),t.remove()}));var p={id:e,e:o,a:i,c:a,v:t.dataset.v?this.json.decode(t.dataset.v):{},m:t.dataset.m?String(t.dataset.m).split(";"):[]};return t.removeAttribute("class"),t.removeAttributeNS("data","dataset"),p}return null},t.prototype.get_element_dataset=function(t,e){void 0===e&&(e=null)},t}();e.default=n},171:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Schema=void 0;var n=function(){function t(t){this.app=t}return t.prototype.rules=function(t){return this.app.get_schema_rules(t)},t.prototype.build=function(t,e){var n=this,o=document.createElement(t.nodeName),r=this.app.schema.apply_content(Object.assign([],t.childNodes));return this.app.obj.each(e.a,(function(t,e){o.setAttribute(e,t)})),this.app.obj.each(e.c,(function(t,e){var r;r="string"==typeof t?document.createRange().createContextualFragment(t):n.build(o,t),o.appendChild(r)})),o.append.apply(o,r),o},t.prototype.apply_content=function(t){var e=this;return t.map((function(t){return e.app.is_schema_element(t)?e.app.schema.build(t,e.app.schema.rules(t)):t}))},t.prototype.insert=function(t,e){t.parentNode&&t.parentNode.replaceChild(e,t)},t.prototype.content=function(t){var e=this.app.server.container;(e?document.getElementById(e):document.body).append(this.app.str.to_nodes(t))},t.prototype.context=function(t,e){return void 0===e&&(e=null),this.app.components.context(t,e)},t}();e.Schema=n},607:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),a=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.ServiceProvider=void 0;var i=n(906),s=n(171),p=a(n(665)),c=n(424),u=function(t){this.app=t};e.ServiceProvider=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="schema",e}return r(e,t),e.prototype.register=function(){var t=this,e=document.querySelectorAll("meta[name]"),n={};Object.assign([],e).map((function(t){var e=t.content;"null"===String(e).toLowerCase()?e=null:"true"===String(e).toLowerCase()?e=!0:"false"===String(e).toLowerCase()&&(e=!1),n[t.name]=e})),this.app.inject(new p.default),this.app.bind("server",n),this.app.bind("doc",new c.Doc(this.app)),this.app.bind("schema_class",s.Schema),this.app.singleton("schema_build",(function(){return t.build()})),this.app.singleton("schema",(function(){return new t.app.schema_class(t.app)})),this.app.singleton("components",(function(){return new i.Components(t.app)})),this.app.singleton("elements",(function(){return document.querySelectorAll("[data-er]")}))},e.prototype.boot=function(){var t=this;this.app.schema_build&&this.app.execute("schema_built"),Object.values(document.querySelectorAll("[data-bfg-call]")).map((function(e){var n=t.app.json.decode(e.innerText);n&&t.app.call(n)}))},e.prototype.build=function(){var t=this,e=this.app.elements,n="map"in e?"map":"forEach"in e&&"forEach";return!1!==n&&(e[n]((function(e){t.app.schema.insert(e,t.app.schema.build(e,t.app.schema.rules(e)))})),!0)},e}(u);e.default=l}},e={};return function n(o){if(e[o])return e[o].exports;var r=e[o]={exports:{}};return t[o].call(r.exports,r,r.exports,n),r.exports}(607)})());